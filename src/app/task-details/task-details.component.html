<div class="app-container">
    <div class="main-container">
        <app-side-bar></app-side-bar>
        <!-- Main Content -->
        <main class="content">
            <div class="content-header">
                <div class="control-section">
                    <div class="content-wrapper">
                            <!-- task-details.component.html -->
                            <div class="task-page">
                                <!-- Breadcrumb -->
                                <div class="breadcrumb">
                                    <i class="fas fa-tasks"></i>
                                    <a href="#">Tasks</a> / <span>{{ task.id || 'New Task' }}</span>
                                </div>

                                <!-- Error Message -->
                                <div class="error-message" *ngIf="errorMessage">
                                    <i class="fas fa-exclamation-circle"></i>
                                    {{ errorMessage }}
                                </div>

                                <!-- Header -->
                                <div class="task-header">
                                    <div class="task-title-section">
                                        <div class="title-input-wrapper" *ngIf="isEditMode || isCreateMode">
                                            <i class="fas fa-pen"></i>
                                            <input [(ngModel)]="task.title" 
                                                   name="title" 
                                                   placeholder="Task title"
                                                   class="title-input"
                                                   required />
                                        </div>
                                        <h2 *ngIf="!isEditMode && !isCreateMode">{{ task.title }}</h2>
                                        <div class="task-id" *ngIf="task.id">
                                            <i class="fas fa-hashtag"></i>
                                            {{ task.id }}
                                        </div>
                                    </div>
                                    <div class="action-buttons">
                                        <button *ngIf="!isEditMode && !isCreateMode" 
                                                class="btn btn-primary" 
                                                (click)="onEdit()">
                                            <i class="fas fa-edit"></i>
                                            Edit
                                        </button>
                                        <button *ngIf="isEditMode || isCreateMode" 
                                                class="btn btn-primary" 
                                                (click)="onSubmit()">
                                            <i class="fas fa-save"></i>
                                            Save
                                        </button>
                                        <button class="btn" (click)="onShare()">
                                            <i class="fas fa-share-alt"></i>
                                            Share
                                        </button>
                                    </div>
                                </div>

                                <!-- Main content -->
                                <div class="task-content">
                                    <div class="content-left">
                                        <!-- Status Section -->
                                        <div class="status-section">
                                            <div class="status-buttons">
                                                <button class="btn" 
                                                        *ngFor="let status of ['To Do', 'In Progress', 'Done']"
                                                        [class.active]="task.status === status"
                                                        [disabled]="!isEditMode && !isCreateMode"
                                                        (click)="task.status = status">
                                                    <i class="fas" 
                                                       [class.fa-clock]="status === 'To Do'"
                                                       [class.fa-spinner]="status === 'In Progress'"
                                                       [class.fa-check-circle]="status === 'Done'">
                                                    </i>
                                                    {{ status }}
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Details Section -->
                                        <div class="field-group">
                                            <label>
                                                <i class="fas fa-tags"></i>
                                                Tags
                                            </label>
                                            <input [(ngModel)]="task.tags" 
                                                   name="tags"
                                                   placeholder="Enter tags (comma separated)"
                                                   [disabled]="!isEditMode && !isCreateMode"
                                                   class="input-field" />
                                        </div>

                                        <div class="field-group">
                                            <label>
                                                <i class="fas fa-flag"></i>
                                                Priority
                                            </label>
                                            <select [(ngModel)]="task.priority" 
                                                    name="priority"
                                                    [disabled]="!isEditMode && !isCreateMode"
                                                    class="select-field">
                                                <option *ngFor="let p of priorities" [value]="p">{{ p }}</option>
                                            </select>
                                        </div>

                                        <div class="field-group">
                                            <label>
                                                <i class="fas fa-align-left"></i>
                                                Description
                                            </label>
                                            <textarea [(ngModel)]="task.description" 
                                                      name="description"
                                                      [disabled]="!isEditMode && !isCreateMode"
                                                      rows="5"
                                                      placeholder="Enter task description"
                                                      class="textarea-field"></textarea>
                                        </div>

                                        <!-- Comments Section -->
                                        <div class="activity-section" *ngIf="!isCreateMode">
                                            <div class="tabs">
                                                <button class="tab-btn active">
                                                    <i class="fas fa-comments"></i>
                                                    Comments
                                                </button>
                                                <button class="tab-btn">
                                                    <i class="fas fa-history"></i>
                                                    History
                                                </button>
                                            </div>

                                            <div class="add-comment">
                                                <button class="btn-add-comment" 
                                                        (click)="showCommentForm = true" 
                                                        *ngIf="!showCommentForm">
                                                    <i class="fas fa-plus"></i>
                                                    Add comment
                                                </button>

                                                <form *ngIf="showCommentForm" (ngSubmit)="addComment()" class="comment-form">
                                                    <div class="rich-text-editor">
                                                        <textarea [(ngModel)]="newComment.text" 
                                                                  name="commentText" 
                                                                  placeholder="Add a comment..."
                                                                  required></textarea>
                                                    </div>
                                                    <div class="form-actions">
                                                        <div class="file-upload">
                                                            <label for="file-input" class="file-label">
                                                                <i class="fas fa-paperclip"></i>
                                                                Attach files
                                                            </label>
                                                            <input id="file-input" 
                                                                   type="file" 
                                                                   (change)="onFileSelected($event)" 
                                                                   multiple 
                                                                   class="file-input" />
                                                        </div>
                                                        <div class="buttons">
                                                            <button type="button" 
                                                                    class="btn-cancel" 
                                                                    (click)="showCommentForm = false">
                                                                <i class="fas fa-times"></i>
                                                                Cancel
                                                            </button>
                                                            <button type="submit" 
                                                                    class="btn-submit">
                                                                <i class="fas fa-paper-plane"></i>
                                                                Submit
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </div>

                                            <div class="comments-list">
                                                <div *ngFor="let comment of task.comments" class="comment">
                                                    <div class="comment-header">
                                                        <div class="user-info">
                                                            <img [src]="comment.user.avatar" class="avatar" alt="User avatar"/>
                                                            <span class="username">{{ comment.user.firstname }}</span>
                                                        </div>
                                                        <div class="comment-date">
                                                            <i class="far fa-clock"></i>
                                                            {{ comment.createdAt | date:'MMM d, y HH:mm' }}
                                                        </div>
                                                    </div>
                                                    <div class="comment-content">
                                                        <p>{{ comment.text }}</p>
                                                        <div *ngIf="comment.attachments?.length" class="attachments">
                                                            <div *ngFor="let attachment of comment.attachments" class="attachment">
                                                                <i class="fas fa-file"></i>
                                                                <span>{{ attachment.name }}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="comment-actions">
                                                        <button (click)="editComment(comment)">
                                                            <i class="fas fa-edit"></i>
                                                            Edit
                                                        </button>
                                                        <button (click)="deleteComment(comment._id)">
                                                            <i class="fas fa-trash"></i>
                                                            Delete
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="content-right">
                                        <!-- People Section -->
                                        <div class="people-section">
                                            <h3>
                                                <i class="fas fa-users"></i>
                                                People
                                            </h3>
                                            <div class="field-group">
                                                <label>
                                                    <i class="fas fa-user-check"></i>
                                                    Assignee
                                                </label>
                                                <select [(ngModel)]="task.assignedUser" 
                                                        name="assignedUser"
                                                        [disabled]="!isEditMode && !isCreateMode"
                                                        class="select-field">
                                                    <option *ngFor="let user of users" [value]="user._id">
                                                        {{ user.firstname }} {{ user.lastname }}
                                                    </option>
                                                </select>
                                            </div>
                                            <div class="field-group">
                                                <label>
                                                    <i class="fas fa-project-diagram"></i>
                                                    Project
                                                </label>
                                                <select [(ngModel)]="task.projectId" 
                                                        name="projectId"
                                                        [disabled]="!isEditMode && !isCreateMode"
                                                        class="select-field"
                                                        required>
                                                    <option value="">Select a project</option>
                                                    <option *ngFor="let project of projects" [value]="project._id">
                                                        {{ project.name }}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Dates Section -->
                                        <div class="dates-section">
                                            <h3>
                                                <i class="fas fa-calendar-alt"></i>
                                                Dates
                                            </h3>
                                            <div class="field-group">
                                                <label>
                                                    <i class="fas fa-plus-circle"></i>
                                                    Created
                                                </label>
                                                <span>{{ task.createdAt | date:'MMM d, y' }}</span>
                                            </div>
                                            <div class="field-group">
                                                <label>
                                                    <i class="fas fa-edit"></i>
                                                    Updated
                                                </label>
                                                <span>{{ task.updatedAt | date:'MMM d, y' }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
    
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
