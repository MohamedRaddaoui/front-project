<div class="container my-5">
  <div *ngIf="loading" class="text-center text-muted py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  <div *ngIf="error" class="alert alert-danger text-center py-4 rounded-3">
    {{ error }}
  </div>
  <div *ngIf="question && !loading && !error" class="question-container">
    <div class="question-header mb-4">
      <h1 class="question-title">{{ question.title }}</h1>
      <div class="d-flex flex-wrap gap-3 text-sm text-muted align-items-center">
        <span>By {{ question.author ? (question.author.firstName + ' ' + question.author.lastName) : 'Anonymous' }}</span>
        <span>{{ question.createdAt | date:'mediumDate' }}</span>
        <span>Votes: {{ question.voteScore }}</span>
        <span>Views: {{ question.views }}</span>
        <span>Answers: {{ answers.length }}</span>
        <span class="d-flex flex-wrap gap-2">
          <span *ngFor="let tag of question.tags" class="badge modern-badge">{{ tag }}</span>
        </span>
      </div>
    </div>
    <div class="card modern-card mb-5">
      <div class="card-body p-4">
        <p class="question-content">{{ question.content }}</p>
      </div>
    </div>
    <h2 class="section-title mb-4">Answers ({{ answers.length }})</h2>
    <div *ngIf="answers.length === 0" class="text-center text-muted py-5 bg-light rounded-3 modern-empty">
      No answers yet. Be the first to answer!
    </div>
    <div *ngFor="let answer of answers" class="card modern-card mb-3">
      <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-start gap-3">
          <p class="answer-content flex-grow-1">{{ answer.content }}</p>
          <div class="vote-buttons d-flex flex-column gap-2">
            <button class="btn btn-outline-primary modern-vote-btn" (click)="upvoteAnswer(answer._id)">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-up" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/>
              </svg>
              {{ answer.voteScore }}
            </button>
            <button class="btn btn-outline-danger modern-vote-btn" (click)="downvoteAnswer(answer._id)">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-down" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="d-flex flex-wrap gap-3 text-sm text-muted mt-3">
          <span>By {{ answer.author ? (answer.author.firstName + ' ' + answer.author.lastName) : 'Anonymous' }}</span>
          <span>{{ answer.createdAt | date:'mediumDate' }}</span>
        </div>
      </div>
    </div>
    <h2 class="section-title mb-4">Your Answer</h2>
    <form [formGroup]="answerForm" (ngSubmit)="onSubmit()" class="answer-form">
      <div class="mb-4">
        <textarea
          id="content"
          class="form-control modern-textarea"
          formControlName="content"
          rows="8"
          placeholder="Write your answer here..."
          [class.is-invalid]="answerForm.get('content')?.touched && answerForm.get('content')?.invalid"
        ></textarea>
        <div *ngIf="answerForm.get('content')?.touched && answerForm.get('content')?.invalid" class="invalid-feedback">
          <div *ngIf="answerForm.get('content')?.errors?.['required']">Answer is required.</div>
          <div *ngIf="answerForm.get('content')?.errors?.['minlength']">Answer must be at least 10 characters.</div>
          <div *ngIf="answerForm.get('content')?.errors?.['maxlength']">Answer cannot exceed 5000 characters.</div>
        </div>
      </div>
      <div class="d-flex gap-3">
        <button type="submit" class="btn btn-primary modern-btn" [disabled]="loading">
          <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
          Post Answer
        </button>
      </div>
      <div *ngIf="error" class="alert alert-danger mt-4 rounded-3" role="alert">{{ error }}</div>
      <div *ngIf="success" class="alert alert-success mt-4 rounded-3" role="alert">{{ success }}</div>
    </form>
  </div>
</div>